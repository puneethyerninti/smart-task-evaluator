## Smart Task Evaluator

Full-stack SaaS starter that lets authenticated users submit coding tasks, trigger AI-powered evaluations (OpenAI), and unlock full reports via Stripe Checkout. Supabase handles auth/Postgres/Edge Functions.

### Stack

- Next.js 16 App Router (React 19, Tailwind 4)
- Supabase Auth + Postgres + Edge Functions (Deno)
- Stripe Checkout + webhooks
- OpenAI Responses API

### Prerequisites

- Node.js 20+
- Supabase project with `tasks`, `reports`, `payments` tables and the `run-evaluation` Edge Function deployed
- Stripe account + test mode keys
- OpenAI API key (Responses API access)

### Environment

Copy `.env.example` to `.env.local` and fill in real values:

```
cp .env.example .env.local
```

Required variables:

- `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`
- `NEXT_PUBLIC_SUPABASE_FUNCTIONS_URL`
- `OPENAI_API_KEY`, optional `OPENAI_MODEL`
- `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`, `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET`
- `NEXT_PUBLIC_REPORT_PRICE_CENTS`, `NEXT_PUBLIC_APP_URL`
- `NEXT_DISABLE_TURBOPACK=1` (already handled by `npm run dev`)

### Development

Install dependencies and run the dev server (Turbopack disabled to avoid Supabase source map issues):

```bash
npm install
npm run dev
```

Visit `http://localhost:3000`.

### Supabase helpers

- `lib/supabase/server.ts` – memoized `createServerComponentClient` for App Router server components
- `lib/supabase/client.ts` – `createClientComponentClient` for client components/hooks
- `lib/supabase/api.ts` – `createRouteHandlerClient` wrapper for App Router route handlers

Use the appropriate helper per environment to ensure cookies/session handling works with Next.js 15/16.

### Stripe webhook

Configure the webhook endpoint at `/api/stripe/webhook` and set `STRIPE_WEBHOOK_SECRET`. Successful payments unlock the corresponding `reports` row.

### Supabase Edge Function

`supabase/functions/run-evaluation` is a Deno function that fetches a task, calls OpenAI, and stores a locked report. Deploy with:

```
supabase functions serve run-evaluation --env-file supabase/.env
supabase functions deploy run-evaluation
```
